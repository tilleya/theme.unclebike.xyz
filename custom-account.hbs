{{!< default}}
{{#post}}

{{#if @member.paid}}
<section class="account-section">
  <div class="container">

    <!-- HEADER -->
    <header class="account-header archive-wrap archive-alternate{{#if feature_image}} is-cover{{/if}}">
      <div class="archive-container">
        <h1 class="global-title">
          {{#if @member.name}}{{@member.name}}{{else}}{{t "Your account"}}{{/if}}
        </h1>
        <p class="archive-description body-2 account-description">
          {{#if custom_excerpt}}
            {{custom_excerpt}}
          {{else}}
            {{t "Nice, you're a paying subscriber! You've an active account with access to all areas. You're all set, but if you need any help, get in touch with us and we'd be happy to help."}}
          {{/if}}
        </p>
      </div>
      {{#if feature_image}}
        <div class="archive-cover global-image">
          {{>images/custom_feature_img}}
        </div>
      {{/if}}
    </header>

    <!-- BILLING DETAILS -->
    {{#foreach @member.subscriptions}}
    <section class="account-details global-box-shadow">
      <h2 class="h3 account-details-title">{{t "Account details"}}</h2>

      <!-- use definition list for semantic clarity -->
      <dl class="account-details-list">
        <div class="account-detail-column">
          <dt class="account-detail-heading">{{t "Email address"}}</dt>
          <dd class="account-detail-content">{{@member.email}}</dd>

          <dt class="account-detail-heading">{{t "Your plan"}}</dt>
          <dd class="account-detail-content">
            {{tier.name}} — {{price plan}}/{{plan.interval}}
          </dd>
        </div>

        <div class="account-detail-column">
          <dt class="account-detail-heading">{{t "Card"}}</dt>
          <dd class="account-detail-content">
            **** **** **** {{default_payment_card_last4}}
          </dd>

          <dt class="account-detail-heading">
            {{#if cancel_at_period_end}}
              {{t "Expires"}}
            {{else}}
              {{t "Next bill date"}}
            {{/if}}
          </dt>
          <dd class="account-detail-content">
            {{date current_period_end format="DD MMM YYYY"}}
          </dd>
        </div>
      </dl>

      <!-- ACTIONS -->
      <div class="account-actions">
        {{!-- Cancel/Continue button uses your global-button styles --}}
        {{cancel_link
          class="button button-secondary account-detail-cancel-button"
          errorClass="account-detail-cancel-error"
          cancelLabel=(t "Cancel subscription")
          continueLabel=(t "Continue subscription")
        }}

        {{#if cancel_at_period_end}}
          <p class="account-detail-alert small">
            {{t "Your subscription will expire on"}} — {{date current_period_end format="DD MMMM YYYY"}}.
            {{t "If you change your mind in the meantime you can turn auto-renew back on to continue your subscription."}}
          </p>
        {{/if}}

        <div class="account-action-links">
          {{#if @member.subscriptions.[0]}}
  <a  
    id="cieg-trigger"  
    class="button button-primary"  
    href="#"  
    data-plan-id="{{@member.subscriptions.[0].plan.id}}"
  >
    {{t "Book with Member Perks"}}
  </a>
{{/if}}
          <a class="button button-secondary" href="javascript:" data-portal="account">
            {{t "Account settings"}}
          </a>
          <a class="button button-secondary" href="javascript:" data-members-edit-billing>
            {{t "Edit billing info"}} &rarr;
          </a>
        </div>
      </div>
    </section>
    {{/foreach}}

    <!-- LATEST POSTS FOR PAID -->
    {{#get "posts" limit="5" filter="visibility:[paid,tiers]" include="authors,tiers" as |paid_posts|}}
      {{#if paid_posts}}
      <section class="special-section">
        <h2 class="h3 membership-heading global-heading">
          {{t "The latest posts only for paying subscribers"}}
        </h2>
        {{>sections_content}}
      </section>
      {{/if}}
    {{/get}}
  </div>
</section>

{{else if @member}}
<section class="account-section">
  <div class="container">

    <!-- HEADER FOR FREE MEMBER -->
    <header class="account-header archive-wrap archive-alternate{{#if feature_image}} is-cover{{/if}}">
      <div class="archive-container">
        <h1 class="global-title">
          {{#if @member.name}}{{@member.name}}{{else}}{{t "Your account"}}{{/if}}
        </h1>
        <p class="archive-description body-2 account-description">
          {{#if custom_excerpt}}
            {{custom_excerpt}}
          {{else}}
            {{#if @site.paid_members_enabled}}
              {{t "Currently, you're not a paying subscriber. You've an active account with access to posts for subscribers only. Upgrade your account and get access to the full library of posts."}}
            {{else}}
              {{t "You’ve an active account with access to posts for subscribers."}}
            {{/if}}
          {{/if}}
        </p>
      </div>
      {{#if feature_image}}
        <div class="archive-cover global-image">
          {{>images/custom_feature_img}}
        </div>
      {{/if}}
    </header>

    <!-- ACCOUNT DETAILS FOR FREE -->
    <section class="account-details global-box-shadow">
      <h2 class="h3 account-details-title">{{t "Account details"}}</h2>
      <dl class="account-details-list">
        <div class="account-detail-column">
          <dt class="account-detail-heading">{{t "Email address"}}</dt>
          <dd class="account-detail-content">{{@member.email}}</dd>
        </div>
        {{#if @site.paid_members_enabled}}
        <div class="account-detail-column">
          <dt class="account-detail-heading">{{t "Your plan"}}</dt>
          <dd class="account-detail-content">{{t "Free"}}</dd>
        </div>
        {{/if}}
      </dl>
      <div class="account-action-links">
        <a class="button button-primary" href="javascript:" data-portal="account">
          {{t "Account settings"}}
        </a>
{{#if @member.subscriptions.[0]}}
  <a  
    id="cieg-trigger"  
    class="button button-primary"  
    href="#"  
    data-plan-id="{{@member.subscriptions.[0].plan.id}}"
  >
    {{t "Book with Member Perks"}}
  </a>
{{/if}}
      </div>
   

    </section>

    <!-- UPGRADE CTA -->
    {{#if @site.paid_members_enabled}}
    <section class="upgrade-section">
      <h2 class="h3 membership-heading global-heading">{{t "Want more perks? Become a member!"}}</h2>
      {{>members/tiers}}
    </section>
    {{/if}}

  </div>
</section>

{{else}}
<script>
  window.addEventListener("load", function() {
    window.location = '{{@site.url}}';
  });
</script>
{{#contentFor "footer"}}
<script>
document.addEventListener("DOMContentLoaded", function() {
  var btn = document.getElementById("cieg-trigger");
  if (!btn) return;

  var urlMap = {
    "price_1RPqpPECGitNFWv4IP5VLhrh": "https://widget.zenbooker.com/book/1746111848718x728354147005624300?embed=true&category=1747514527053x318956607590891500",
    "price_1RPqpOECGitNFWv45T56svDJ": "https://widget.zenbooker.com/book/1746111848718x728354147005624300?embed=true&category=1747514527053x318956607590891500",
    "price_1RPr8jECGitNFWv4vu5u2Aia": "https://widget.zenbooker.com/book/1746111848718xAAAABBBCCCDDD?embed=true&category=1747514527053x318956607590891500&coupon_code=READY15",
    "price_1RPr8iECGitNFWv4Hr7G5TzF": "https://widget.zenbooker.com/book/1746111848718xAAAABBBCCCDDD?embed=true&category=1747514527053x318956607590891500&coupon_code=READY15",
    "price_1R8RchECGitNFWv49yHCYY7U": "https://widget.zenbooker.com/book/1746111848718xXXXYYYZZZ123?embed=true&category=999888777666555444"
    "price_1R8RcgECGitNFWv4aRyqEHUs": "https://widget.zenbooker.com/book/1746111848718xXXXYYYZZZ123?embed=true&category=999888777666555444"
    // …add any other plan → widget URLs here
  };

  var planId = btn.dataset.planId;
  var widgetUrl = urlMap[planId] || urlMap["price_1L2hseECGitNFWv4Cqsnd9mC"]; 
  // fallback to a default if you like

  btn.addEventListener("click", function(e) {
    e.preventDefault();
    Zenbooker.showPopupWidget(widgetUrl);
  });
});
</script>
{{/contentFor}}
{{/if}}

{{/post}}